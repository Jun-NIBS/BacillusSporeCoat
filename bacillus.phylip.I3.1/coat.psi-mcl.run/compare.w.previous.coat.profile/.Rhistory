strsplit( comp$Bha[43] )
strsplit( comp$Bha[43], ' ' )
strsplit( comp$Bha[43], ' ' )[[1]]
strsplit( 'hell', ' ' )[[1]]
x = c(1,2,3);
y = c(4);
insersect( x,y)
intersect( x,y)
x = c('a','b');
y = c('c');
intersect( x, y)
intersect( x, y)[1]
intersect( x, 'a')[1]
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       answer = inersect( els1, els2 );
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
summary(comp)
table
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = inter; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = inter; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strplit( oldhits, ' ' )[[1]];
       els2 = strspli( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = inersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = intersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
comp
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    comp[r,(c+1)] = NA; answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = intersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = intersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
oldnames
psinames
table( comp$Bsu );
table( comp$Bmo );
table( comp$Bam );
table( comp$Bli );
table( comp$Bpu );
table( comp$Bli );
table( comp$Bwe );
table( comp$Bth );
comp
str(comp)
head(comp)
table( comp$Bce79 )
table( comp$Ban )
table( comp$Bth )
table( comp$Bwe )
r=1;
  subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( subcer4 );
tmp
subcer4
    tmp = table( t(subcer4) );
tmp
tmp[1]
tmp["TRUE"]
#summarize Ban Bth Bce79 Bwe
for( r in 1 : length(oldprofile[,1]) ) {
    subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( t( subcer4 ) );
    comp$cer4 = tmp["TRUE"]
}
comp
#summarize Ban Bth Bce79 Bwe
for( r in 1 : length(oldprofile[,1]) ) {
    subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( t( subcer4 ) );
    comp$cer4[r] = tmp["TRUE"]
}
comp
table( comp$cer4)
comp[69,]
#summarize Ban Bth Bce79 Bwe
for( r in 1 : length(oldprofile[,1]) ) {
    subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( t( subcer4 ) );
    comp$cer4[r] = tmp["TRUE"];
    if( is.na( tmp["TRUE"] ) ) { 
      comp$cer4[r] = 0;
    }
}
comp[69,]
table( comp$cer4)
str(comp)
inconsistent.coat = comp$coat[ comp$cer4 < 4 ]
inconsistent.coat
str(oldprofile)
str(psiprofile)
inconsistent.oldprofile = oldprofile[ match(inconsistent.coat, oldprofile$id),  ]
inconsistent.psiprofile = psiprofile[ match(inconsistent.coat, psiprofile$coat), ]
inconsistent.oldprofile
inconsistent.psiprofile
inconsistent.psiprofile
inconsistent.oldprofile[ , c("Ban","Bth","Bce","Bwe")]
inconsistent.psiprofilec[,("Ban","Bth","Bce","Bwe")] 
inconsistent.psiprofilec[, c("Ban","Bth","Bce","Bwe")] 
inconsistent.oldprofile[ , c("Ban","Bth","Bce","Bwe")]
inconsistent.psiprofilec[, c("Ban","Bth","Bce79","Bwe")] 
inconsistent.psiprofile[, c("Ban","Bth","Bce79","Bwe")] 
inconsistent.oldprofile[ , c("id","Ban","Bth","Bce","Bwe")]
inconsistent.psiprofile[, c("coat","Ban","Bth","Bce79","Bwe")] 
?write.csv
pretb = read.csv("_coat.profile.comparisons.Feb11,2010.csv", sep="\t");
psitb = read.csv("_profile.from.psi.mcl.I31.clus.021510.csv", sep="\t");
oldprofile = pretb[,c(1,14:24)]
psiprofile = psitb[,-c(15,16)]
for( c in 1:length(oldprofile[1,]) ) {
 oldprofile[,c] = as.character( oldprofile[,c]); 
}
for( c in 1:length(psiprofile[1,]) ) {
 psiprofile[,c] = as.character( psiprofile[,c]); 
}
#check the orders
x = match(psiprofile$coat, oldprofile$id );
x - 1:73 #good
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = intersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
table( comp$Bmo );
table( comp$Bam );
table( comp$Bli );
table( comp$Bpu );
table( comp$Ban );
table( comp$Bth );
table( comp$Bwe );
table( comp$Bcl );
table( comp$Bha );
table( comp$Bce87 );
table( comp$Bce79 );
table( comp$Bce3L );
#summarize Ban Bth Bce79 Bwe
for( r in 1 : length(oldprofile[,1]) ) {
    subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( t( subcer4 ) );
    comp$cer4[r] = tmp["TRUE"];
    if( is.na( tmp["TRUE"] ) ) { 
      comp$cer4[r] = 0;
    }
}
#Find inconsistent ones
inconsistent.coat = comp$coat[ comp$cer4 < 4 ]
inconsistent.oldprofile = oldprofile[ match(inconsistent.coat, oldprofile$id),  ]
inconsistent.psiprofile = psiprofile[ match(inconsistent.coat, psiprofile$coat), ]
inconsistent.oldprofile[ , c("id","Ban","Bth","Bce","Bwe")]
inconsistent.psiprofile[ , c("coat","Ban","Bth","Bce79","Bwe")] 
write.csv( inconsistent.oldprofile, "inconsistent.oldprofile.022410.csv", row.names=F );
write.csv( inconsistent.psiprofile, "inconsistent.psiprofile.022410.csv", row.names=F );
pretb = read.csv("_coat.profile.comparisons.Feb11,2010.csv", sep="\t");
psitb = read.csv("_profile.from.psi.mcl.I31.clus.021510.csv", sep="\t");
oldprofile = pretb[,c(1,14:24)]
psiprofile = psitb[,-c(15,16)]
for( c in 1:length(oldprofile[1,]) ) {
 oldprofile[,c] = as.character( oldprofile[,c]); 
}
for( c in 1:length(psiprofile[1,]) ) {
 psiprofile[,c] = as.character( psiprofile[,c]); 
}
#check the orders
x = match(psiprofile$coat, oldprofile$id );
x - 1:73 #good
comp = psiprofile; #store comparison results
oldnames = names(oldprofile)[2:12]
oldnames = oldnames[c(1:6, 7,7,7:11)]
psinames = names( psiprofile ) [2:14]
cbind( oldnames, psinames) #double check
oldnames == psinames
#compare profiles
for( r in 1 : length(oldprofile[,1]) ) {
  for( c in 1 : length(oldnames) ) {
    answer = '';
    oldhits = oldprofile[ r, oldnames[c] ];
    psihits = psiprofile[ r, psinames[c] ];
    if ( (is.na(oldhits)) & (is.na(psihits) ) ) { 
       answer = TRUE; 
    } else if (is.na(oldhits) ) {
       answer = psihits; 
    } else if ( is.na(psihits) ) {
       answer = oldhits;
    }  else {
       els1 = strsplit( oldhits, ' ' )[[1]];
       els2 = strsplit( psihits, ' ')[[1]];
       #answer = (oldhits == psihits )[1]
       inter = intersect( els1, els2 );
       if (is.na(inter[1]) ) { answer =FALSE;
       } else { answer = TRUE; }
    }  
    comp[r,(c+1)] = answer; 
  }
}
table( comp$Bsu );
table( comp$Bmo );
table( comp$Bam );
table( comp$Bli );
table( comp$Bpu );
table( comp$Ban );
table( comp$Bth );
table( comp$Bwe );
table( comp$Bcl );
table( comp$Bha );
table( comp$Bce87 );
table( comp$Bce79 );
table( comp$Bce3L );
#summarize Ban Bth Bce79 Bwe
for( r in 1 : length(oldprofile[,1]) ) {
    subcer4 = comp[r, c("Ban", "Bth", "Bce79", "Bwe")]; 
    tmp = table( t( subcer4 ) );
    comp$cer4[r] = tmp["TRUE"];
    if( is.na( tmp["TRUE"] ) ) { 
      comp$cer4[r] = 0;
    }
}
#Find inconsistent ones
inconsistent.coat = comp$coat[ comp$cer4 < 4 ]
inconsistent.oldprofile = oldprofile[ match(inconsistent.coat, oldprofile$id),  ]
inconsistent.psiprofile = psiprofile[ match(inconsistent.coat, psiprofile$coat), ]
inconsistent.oldprofile[ , c("id","Ban","Bth","Bce","Bwe")]
inconsistent.psiprofile[ , c("coat","Ban","Bth","Bce79","Bwe")] 
write.csv( inconsistent.oldprofile, "_inconsistent.oldprofile.022410.csv", row.names=F );
write.csv( inconsistent.psiprofile, "_inconsistent.psiprofile.022410.csv", row.names=F );
inconsistent.oldprofile$id
